<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Víctor Cantera">
        <link rel="icon" href="../../assets/img/comercia_ico.png" type="image/x-icon"/ >
        <title>Operativa Google Pay JS</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="../../assets/js/javascript.js"></script>

        <!-- Bootstrap 4.3.1 -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <!-- CSS -->
        <link rel="stylesheet" href="../../assets/css/style.css">

        <script async src="https://pay.google.com/gp/p/js/pay.js" onload="onGooglePayLoaded()"></script>
    </head>

    <body>
        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg navbar-light navbar-rpdc mb-3">
            <a class="navbar-brand">
                <img src="../../assets/img/log2.svg" width="30" height="30" class="img-fluid" alt="Logo Addon Payments">
                <span class="addonNav">ADDON</span> <span>PAYMENTS</span>
                <span class="d-none d-sm-none d-lg-inline d-xl-inline sdkNav">
                    <span>
                        /Google
                        <span class="barraNav">_</span>
                        Pay
                        <span class="barraNav">_</span>
                        JS
                    </span>
                </span>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
          </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto pl-2 pr-2">
                    <li class="nav-item dropdown">
                        <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Inicio
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item pl-2" href="../../index.html">Índice</a>
                            <a class="dropdown-item pl-2" href="../errores.html">Errores de Addon Payments</a>
                            <a class="dropdown-item pl-2" href="../informe.html">Convertir informe</a>
                        </div>
                    </li>
                    <li class="nav-item ml-1 dropdown">
                        <a class="nav-link pl-2 dropdown-toggle active" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Google Pay
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item pl-2 active" href="#">Operación Google Pay JS</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- /NAVBAR -->
        
        <div class="col-lg-12"> 
            <div id="contenidoComun" class="container-fluid">
                <div class="row">

                    <!-- Menú lateral -->
                    <div class="col-lg-2 sticky-top d-none d-sm-none d-lg-block d-xl-block MenuLateral">

                        <!-- Barra de progreso -->
                        <div class="progress-bar" id="progreso"></div>
                        <!-- /Barra de progreso -->

                        <nav class="navbar sticky-top navbar-light" style="padding: 0px;">
                            <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="#api">1. Google Pay Javascript (web)</a>
                                <nav>
                                  <a class="nav-link ml-3 my-1" href="#codigoPhp">1.1 Autorización</a>
                                  <a class="nav-link ml-3 my-1" href="#codigoJs">1.2 JavaScript</a>
                                </nav>
                                <a class="nav-link" href="#gpay2">2. Google Pay</a>
                                <nav class="nav nav-pills flex-column">
                                  <a class="nav-link ml-3 my-1" href="#paspro">2.1 Pasar a producción</a>
                                </nav>
                                <a class="nav-link" href="#btnGooglePay">3. Botón Google Pay</a>
                                <nav class="nav nav-pills flex-column">
                                    <a class="nav-link ml-3 my-1" href="#btnGooglePay">3.1 Ejemplo</a>
                                </nav>
                            </nav>
                        </nav>
                    </div>
                    <!-- /Menú lateral -->

                    <!-- Contenido común -->
                    <div class="col-lg-10" >

						<!-- Punto 1-->
						<div class="contenedor">
							<div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
								<h3 id="api" class="titulo">
									1. Google Pay Javascript (web)
								</h3>
								<hr>

								<p>
                                    Para permitir los pagos con Google Pay, debe programar su página web en base a las funciones de JavaScript implementadas en el en la librería facilitada por <a href="https://pay.google.com/gp/p/js/pay.js">Google</a>.
                                </p>
                                <p>
                                    En esta documentación indicamos cómo realizar las peticiones desde nuestro Front a nuestro servidor para realizar los cobros enviando el token que nos facilita Google.
                                </p>
    
								<h5 class="pt-3" id="codigoPhp">1.1 Autorización</h5>

								<hr>

                                <p>
                                    En esta guía hemos realizado la integración de nuestro servidor con el SDK de PHP.
                                    <small class="form-text text-muted alert alert-primary">
                                        --&gt; Puede comprobar los SDK's que tenemos actualmente disponibles en <a target="_blank" href="https://github.com/addonpayments">nuestro GitHub</a>.
                                    </small>
                                </p>

                                <p>
                                    Código del archivo de autorización que alojamos en nuestro servidor.
                                </p>

                                <div class="p-4 panelCode">
                                    <code>
                                        <b>
                                            <span class="etiqueta">&lt;?php</span>
                                        </b>
                                        <br>
                                        <br>
                                            <span class="pl-3 comments">// Imports necesarios para realizar una aturoización</span>
                                        <br>
                                            <span class="pl-3 require">require_once('</span><span class="green">vendor/autoload.php</span><span class="require">');</span>
                                        <br>
                                        <br>
                                            <span class="pl-3 require">use </span><span class="imports">AddonPayments\Api\ServicesConfig</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3 require">use </span><span class="imports">AddonPayments\Api\ServicesContainer</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3 require">use </span><span class="imports">AddonPayments\Api\PaymentMethods\CreditCardData</span><span class="pl-3 require">;</span>
                                        <br>
                                            <span class="pl-3 require">use </span><span class="imports">AddonPayments\Api\Entities\Enums\EncyptedMobileType</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3 require">use </span><span class="imports">AddonPayments\Api\Entities\Enums\TransactionModifier</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3 require">use </span><span class="imports">AddonPayments\Api\Entities\Exceptions\ApiException</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3 require">use </span><span class="imports">AddonPayments\Api\Entities\Transaction</span><span class=" require">;</span>
                                        <br>
                                        <br>
                                            <span class="pl-3 comments">// Configuración del terminal</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">config</span> <span class="require">=</span> <span class="new">new</span> <span class="yellow">ServicesConfig()</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">config</span><span class="require">-></span><span class="new">merchantId</span> <span class="require">= "</span><span class="green">Merchant_ID</span><span class="require">";</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">config</span><span class="require">-></span><span class="new">accountId</span> <span class="require">= "</span><span class="green">Sub_Account</span><span class="require">";</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">config</span><span class="require">-></span><span class="new">sharedSecret</span> <span class="require">= "</span><span class="green">Shared_Secret</span><span class="require">";</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">config</span><span class="require">-></span><span class="new">serviceUrl</span> <span class="require">= "</span><span class="green">https://remote.sandbox.addonpayments.com/remote</span><span class="require">";</span>
                                        <br>
                                            <span class="pl-3 yellow">ServicesContainer</span><span class="configure">::configure</span><span class="require">(</span>$<span class="new">config</span><span class="require">);</span>
                                        <br>
                                        <br>
                                            <span class="pl-3">$</span><span class="white">tokenFinal </span><span class="new">= </span>$<span class="white">_POST</span><span class="new">['</span><span class="green">misDatos</span><span class="new">'];</span>
                                        <br>
                                        <br>
                                            <span class="pl-3 comments">// Creamos el objeto tarjeta</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">card</span> <span class="require">= </span><span class="purple">new</span> <span class="yellow">CreditCardData()</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">card</span><span class="require">-></span><span class="white">token</span> <span class="require">= </span>$<span class="white">tokenFinal</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-3">$</span><span class="new">card</span><span class="require">-></span><span class="white">mobileType </span> <span class="require">= </span><span class="yellow">EncyptedMobileType</span><span class="require">::</span><span class="white">GOOGLE_PAY</span><span class="require">;</span>
                                        <br>
                                        <br>
                                            <span class="pl-3">$</span><span class="white">response </span><span class="require">= </span><span class="purple">new </span><span class="yellow">Transaction()</span><span class="require">;</span>
                                        <br>
                                        <br>
                                            <span class="pl-3 comments">// Lanzamos la petición al servidor de Addon Payments</span>
                                        <br>
                                            <span class="pl-3 new">try</span><span class="require"> {</span>
                                        <br>
                                            <span class="pl-4">$</span><span class="white">response</span> <span class="require">= </span>$<span class="white">card</span><span class="require">-></span><span class="configure">charge</span><span class="require">(</span><span class="orange">10</span><span class="require">)</span>
                                        <br>
                                            <span class="pl-5 require">-></span><span class="configure">withCurrency</span><span class="require">("</span><span class="green">EUR</span><span class="require">")</span>
                                        <br>
                                            <span class="pl-5 require">-></span><span class="configure">withModifier</span><span class="require">(</span><span class="yellow">TransactionModifier</span><span class="require">::ENCRYPTED_MOBILE)</span>
                                        <br>
                                            <span class="pl-5 require">-></span><span class="configure">execute</span><span class="require">(</span><span class="require">);</span>
                                        <br>
                                        <br>
                                            <span class="comments pl-4">// Obtenemos la respuesta y la devolvemos en formato JSON</span>
                                        <br>
                                            <span class="pl-4 require">header('</span><span class="green">Content-Type: application/json</span><span class="require">');</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 require">echo json_encode(array(</span>
                                        <br>
                                            <span class="pl-5 require">'</span><span class="green">respuesta</span><span class="require">' => </span>$<span class="white">result </span><span class="require">= </span>$<span class="white">response</span><span class="require">-></span><span class="white">responseCode</span><span class="require">,</span>
                                        <br>
                                            <span class="pl-5 require">'</span><span class="green">mensaje</span><span class="require">' => </span>$<span class="white">message </span><span class="require">= </span>$<span class="white">response</span><span class="require">-></span><span class="white">responseMessage</span><span class="require">,</span>
                                        <br>
                                            <span class="pl-5 require">'</span><span class="green">orderid</span><span class="require">' => </span>$<span class="white">orderId </span><span class="require">= </span>$<span class="white">response</span><span class="require">-></span><span class="white">orderId</span><span class="require">,</span>
                                        <br>
                                            <span class="pl-5 require">'</span><span class="green">codeauth</span><span class="require">' => </span>$<span class="white">authCode </span><span class="require">= </span>$<span class="white">response</span><span class="require">-></span><span class="white">authorizationCode</span><span class="require">,</span>
                                        <br>
                                            <span class="pl-5 require">'</span><span class="green">pasref</span><span class="require">' => </span>$<span class="white">paymentsReference </span><span class="require">= </span>$<span class="white">response</span><span class="require">-></span><span class="white">transactionId</span><span class="require">,</span>
                                        <br>
                                            <span class="pl-5 require">'</span><span class="green">schemeId</span><span class="require">' => </span>$<span class="white">schemeReferenceData </span><span class="require">= </span>$<span class="white">response</span><span class="require">-></span><span class="white">schemeId</span>
                                        <br>
                                            <span class="pl-4 require">));</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 require">exit;</span>
                                        <br>
                                        <br>
                                            <span class="pl-3 require">}</span><span class="new"> catch</span> (<span class="yellow">ApiException</span> $<span class="variables">e</span>) <span class="require">{</span>
                                        <br>
                                            <span class="comments pl-4">// Añada aquí su tratamiento de errores</span>
                                        <br>
                                            <span class="pl-4 require">echo</span> $<span class="variables">e</span><span class="require">-></span><span class="configure">getMessage</span><span class="require">();</span>
                                        <br>
                                            <span class="pl-3 require">}</span>
                                        <br>
                                        <br>
                                        <b>
                                            <span class="etiqueta">?&gt;</span>
                                        </b>
                                    </code>
                                </div>

                                <h5 class="pt-4" id="codigoJs">1.2 JavaScript</h5>

                                <hr>

                                <p>
                                    Con el código javascript que facilitamos a continuación podremos obtener el token que facilita Google y enviar la operación a nuestro servidor realizando peticiones asíncronas.
                                </p>

                                <div class="p-4 panelCode">
                                    <code>
                                            <span class="pl-2 new">&lt;</span><span class="script">button</span> <span class="new">type=</span><span class="require">"</span><span class="green">button</span><span class="require">" </span><span class="new"> id=</span><span class="require">"</span><span class="green">googlePay</span><span class="require">"</span><span class="new">&gt;</span><span class="white">Comprar con Google Pay</span><span class="new">&lt;</span><span class="script">/button</span><span class="new">&gt;</span>
                                        <br>
                                        <br>
                                            <span class="pl-2 new">&lt;</span><span class="script">script </span><span class="function">async src</span><span class="require">="</span><span class="green">https://pay.google.com/gp/p/js/pay.js</span><span class="require">" </span><span class="function">onload</span><span class="new">=</span><span class="require">"</span><span class="new">onGooglePayLoaded</span><span class="require">()"</span><span class="new">&gt;</span><span class="new">&lt;</span><span class="script">/script</span><span class="new">&gt;</span>
                                        <br>
                                        <br>
                                            <span class="pl-2 new">&lt;</span><span class="script">script</span><span class="new">&gt;</span>
                                        <br>
                                            <span class="pl-4 comments">// Indicamos la versión que vamos a usar de la API de Google</span>
                                        <br>
                                            <span class="pl-4 purple">const </span><span class="white">baseRequest </span><span class="new">= </span><span class="require">{</span>
                                        <br>
                                            <span class="pl-5 white">apiVersion</span><span class="require">:</span><span class="orange">2</span><span class="require">,</span>
                                        <br>
                                            <span class="pl-5 white">apiVersionMinor</span><span class="require">:</span><span class="orange">0</span><span class="require"></span>
                                        <br>
                                            <span class="pl-4 require">};</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Indicamos las tarjetas disponibles</span>
                                        <br>
                                            <span class="pl-4 purple">const </span><span class="white">allowedCardNetworks </span><span class="new">= </span><span class="require">["</span><span class="green">AMEX</span><span class="require">", "</span><span class="green">DISCOVER</span><span class="require">", "</span><span class="green">JCB</span><span class="require">", "</span><span class="green">MASTERCARD</span><span class="require">", "</span><span class="green">VISA</span><span class="require">"];</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Métodos de autenticación de tarjetas apoyados por su sitio y CaixaBank</span>
                                        <br>
                                            <span class="pl-4 purple">const </span><span class="white">allowedCardAuthMethods </span><span class="new">= </span><span class="require">["</span><span class="green">PAN_ONLY</span><span class="require">", "</span><span class="green">CRYPTOGRAM_3DS</span><span class="require">"];</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Identifique su puerta de enlace (globalpayments) y el Merchant ID</span>
                                        <br>
                                            <span class="pl-4 purple">const </span><span class="white">tokenizationSpecification </span><span class="new">= </span><span class="require">{</span>
                                        <br>
                                            <span class="pl-5 white">type</span><span class="require">: '</span><span class="green">PAYMENT_GATEWAY</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-5 white">parameters</span><span class="require">: {</span>
                                        <br>
                                            <span class="pl-6 white">gateway</span><span class="require">: '</span><span class="green">globalpayments</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-6 white">gatewayMerchantId</span><span class="require">: '</span><span class="green">MerchantID</span><span class="require">'</span>
                                        <br>
                                            <span class="pl-5 require">}</span>
                                        <br>
                                            <span class="pl-4 require">};</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Indique que su página web permite pago con tarjeta</span>
                                        <br>
                                            <span class="pl-4 purple">const </span><span class="white">baseCardPaymentMethod </span><span class="new">= </span><span class="require">{</span>
                                        <br>
                                            <span class="pl-5 white">type</span><span class="require">: '</span><span class="green">CARD</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-5 white">parameters</span><span class="require">: {</span>
                                        <br>
                                            <span class="pl-6 white">allowedAuthMethods</span><span class="require">: </span><span class="white">allowedCardAuthMethods</span><span class="require">,</span>
                                        <br>
                                            <span class="pl-6 white">allowedCardNetworks</span><span class="require">: </span><span class="white">allowedCardNetworks</span>
                                        <br>
                                            <span class="pl-5 require">}</span>
                                        <br>
                                            <span class="pl-4 require">);</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 purple">const </span><span class="white">cardPaymentMethod </span><span class="new">= </span><span class="yellow">Object</span><span class="require">.</span><span class="new">assign</span><span class="require">(</span>
                                        <br>
                                            <span class="pl-5 require">{},</span>
                                        <br>
                                            <span class="pl-5 white">baseCardPaymentMethod</span><span class="require">, {</span>
                                        <br>
                                            <span class="pl-6 new">tokenizationSpecification</span><span class="require">: </span><span class="white">tokenizationSpecification</span>
                                        <br>
                                            <span class="pl-5 require">}</span>
                                        <br>
                                            <span class="pl-4 require">};</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Inicialice google.payments.api.PaymentsClient object or null si aún no se ha establecido</span>
                                        <br>
                                            <span class="pl-4 purple">let </span><span class="white">paymentsClient </span><span class="new">= </span><span class="orange">null</span><span class="require">;</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Configure la compatibilidad de su sitio con los métodos de pago admitidos por Google Pay</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">getGoogleIsReadyToPayRequest</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-5 purple">return </span><span class="yellow">Object</span><span class="require">.</span><span class="new">assign</span><span class="require">(</span>
                                        <br>
                                            <span class="pl-6 require">{},</span>
                                        <br>
                                            <span class="pl-6 white">baseRequest</span><span class="require">, {</span>
                                        <br>
                                            <span class="pl-7 new">allowedPaymentMethods</span><span class="require">: [</span><span class="white">baseCardPaymentMethod</span><span class="require">]</span>
                                        <br>
                                            <span class="pl-6 require">}</span>
                                        <br>
                                            <span class="pl-5 require">);</span>
                                        <br>
                                            <span class="pl-4 require">};</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Configurar la compatibilidad con el API de Google Pay</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">getGooglePaymentDataRequest</span><span class="new">() {</span>
                                        <br>
                                            <span class="pl-5 purple">const </span><span class="white">paymentDataRequest </span><span class="new">= </span><span class="yellow">Object</span><span class="require">.</span><span class="new">assign</span><span class="require">({}, </span><span class="white">baseRequest</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-5 white">paymentDataRequest</span><span class="require">.</span><span class="white">allowedPaymentMethods </span><span class="new">= </span><span class="require">[</span><span class="white">cardPaymentMethod</span><span class="require">];</span>
                                        <br>
                                            <span class="pl-5 white">paymentDataRequest</span><span class="require">.</span><span class="white">transactionInfo </span><span class="new">= getGoogleTransactionInfo</span><span class="require">();</span>
                                        <br>
                                            <span class="pl-5 white">paymentDataRequest</span><span class="require">.</span><span class="white">merchantInfo </span><span class="new">= </span><span class="require">{</span>
                                        <br>
                                            <span class="pl-6 white">merchantName</span><span class="require">: '</span><span class="green">Addon Payments</span><span class="require">'</span>
                                        <br>
                                            <span class="pl-5 require">};</span>
                                        <br>
                                            <span class="pl-5 white">paymentDataRequest</span><span class="require">.</span><span class="white">callbackIntents </span><span class="new">= </span><span class="require">["</span><span class="green">PAYMENT_AUTHORIZATION</span><span class="require">"];</span>
                                        <br>
                                            <span class="pl-5 purple">return </span><span class="white">paymentDataRequest</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Devuelve un cliente de pagos activo o inicializado</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">getGooglePaymentsClient</span><span class="new">() {</span>
                                        <br>
                                            <span class="pl-5 purple">if </span><span class="require">(</span><span class="white">paymentsClient </span><span class="new">=== </span><span class="orange">null</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-6 white">paymentsClient </span><span class="new">= new </span><span class="white">google</span><span class="require">.</span><span class="new">payments</span><span class="require">.</span><span class="new">api</span><span class="require">.</span><span class="new">PaymentsClient</span><span class="require">({</span>
                                        <br>
                                            <span class="pl-7 new">environment</span><span class="require">: '</span><span class="green">TEST</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-7 new">paymentDataCallbacks</span><span class="require">: {</span>
                                        <br>
                                            <span class="pl-8 new">onPaymentAuthorized</span><span class="require">: </span><span class="white">onPaymentAuthorized</span>
                                        <br>
                                            <span class="pl-7 require">}</span>
                                        <br>
                                            <span class="pl-6 require">});</span>
                                        <br>
                                            <span class="pl-5 require">}</span>
                                        <br>
                                            <span class="pl-5 purple">return </span><span class="white">paymentsClient</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Envío a nuestro servidor</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">onPaymentAuthorized</span><span class="require">(</span><span class="orange">paymentData</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-5 purple">return </span><span class="new">new </span><span class="yellow">Promise</span><span class="require">(</span><span class="purple">function</span><span class="require">(</span><span class="orange">resolve</span><span class="require">, </span><span class="orange">reject</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-6 new">processPayment</span><span class="require">(</span><span class="white">paymentData</span><span class="require">)</span>
                                        <br>
                                            <span class="pl-6 require">.</span><span class="new">then</span><span class="require">(</span><span class="purple">function</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-7">$</span><span class="require">.</span><span class="new">ajax</span><span class="require">({</span>
                                        <br>
                                            <span class="pl-8 new">url</span><span class="require">: '</span><span class="green">authorization.php</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-8 new">type</span><span class="require">: '</span><span class="green">POST</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-8 new">data</span><span class="require">: {</span><span class="new">misDatos</span><span class="require">: </span><span class="white">paymentData</span><span class="require">["</span><span class="green">paymentMethodData</span><span class="require">"]</span><span class="require">["</span><span class="green">tokenizationData</span><span class="require">"]</span><span class="require">["</span><span class="green">token</span><span class="require">"], </span><span class="new">importe</span><span class="require">: "</span><span class="green">10</span><span class="require">"},</span>
                                        <br>
                                            <span class="pl-8 new">success</span><span class="require">: </span><span class="purple">function</span><span class="require">(</span><span class="orange">data</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-9 purple">if</span><span class="require">(</span><span class="white">data</span><span class="require">.</span><span class="new">respuesta </span><span class="require">== '</span><span class="green">00</span><span class="require">') {</span>
                                        <br>
                                            <span class="pl-10 yellow">console</span><span class="require">.</span><span class="new">log</span><span class="require">(</span><span class="white">data</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-9 require">} </span><span class="purple">else </span><span class="require">{</span>
                                        <br>
                                            <span class="pl-10 yellow">console</span><span class="require">.</span><span class="new">log</span><span class="require">(</span><span class="white">data</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-9 require">}</span>
                                        <br>
                                            <span class="pl-8 require">},</span>
                                        <br>
                                            <span class="pl-8 new">error</span><span class="require">: </span><span class="purple">function</span><span class="require">(</span><span class="orange">error</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-9 yellow">console</span><span class="require">.</span><span class="new">log</span><span class="require">(</span><span class="orange">error</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-8 require">}</span>
                                        <br>
                                            <span class="pl-7 require">});</span>
                                        <br>
                                            <span class="pl-6 require">})</span>
                                        <br>
                                            <span class="pl-6 require">.</span><span class="new">catch</span><span class="require">(</span><span class="purple">function</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-7 new">resolve</span><span class="require">({</span>
                                        <br>
                                            <span class="pl-8 new">transactionState</span><span class="require">: '</span><span class="green">ERROR</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-8 new">error</span><span class="require">: {</span>
                                        <br>
                                            <span class="pl-9 new">intent</span><span class="require">: '</span><span class="green">PAYMENT_AUTHORIZATION</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-9 new">message</span><span class="require">: '</span><span class="green">Insufficient funds</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-9 new">reason</span><span class="require">: '</span><span class="green">PAYMENT_DATA_INVALID</span><span class="require">'</span>
                                        <br>
                                            <span class="pl-8 require">}</span>
                                        <br>
                                            <span class="pl-7 require">});</span>
                                        <br>
                                            <span class="pl-6 require">});</span>
                                        <br>
                                            <span class="pl-5 require">});</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Iniciar Google PaymentsClient después de que se haya cargado el JavaScript alojado en Google</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">onGooglePayLoaded</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-5 purple">const </span><span class="white">paymentsClient </span><span class="new">= </span><span class="new">getGooglePaymentsClient</span><span class="require">();</span>
                                        <br>
                                            <span class="pl-5 white">paymentsClient</span><span class="require">.</span><span class="new">isReadyToPay</span><span class="require">(</span><span class="new">getGoogleIsReadyToPayRequest</span><span class="require">())</span>
                                        <br>
                                            <span class="pl-5 require">.</span><span class="new">then</span><span class="require">(</span><span class="purple">function</span><span class="require">(</span><span class="orange">response</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-6 purple">if </span><span class="require">(</span><span class="white">response</span><span class="require">.</span><span class="new">result</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-7 new">addGooglePayButton</span><span class="require">();</span>
                                        <br>
                                            <span class="pl-6 require">}</span>
                                        <br>
                                            <span class="pl-5 require">})</span>
                                        <br>
                                            <span class="pl-5 require">.</span><span class="new">catch</span><span class="require">(</span><span class="purple">function</span><span class="require">(</span><span class="orange">err</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-6 yellow">console</span><span class="require">.</span><span class="new">error</span><span class="require">(</span><span class="white">err</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-5 require">});</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Creación del botón de compra de Google Pay</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">addGooglePayButton</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-5 purple">const </span><span class="white">paymentsClient </span><span class="new">= </span><span class="new">getGooglePaymentsClient</span><span class="require">();</span>
                                        <br>
                                            <span class="pl-5 purple">const </span><span class="white">button </span><span class="new">= </span><span class="white">paymentsClient</span><span class="require">.</span><span class="new">createButton</span><span class="require">({</span><span class="new">onClick</span><span class="require">: </span><span class="white">onGooglePaymentButtonClicked</span><span class="require">});</span>
                                        <br>
                                            <span class="pl-5 yellow">document</span><span class="require">.</span><span class="new">getElementById</span><span class="require">('</span><span class="green">googlePay</span><span class="require">').</span><span class="new">appendChild</span><span class="require">(</span><span class="white">button</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Proporcionamos a la API de Google Pay un importe de pago, una moneda y un estado de importe</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">getGoogleTransactionInfo</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-5 purple">return </span><span class="require">{</span>
                                        <br>
                                            <span class="pl-6 white">displayItems</span><span class="require">: [ {</span>
                                        <br>
                                            <span class="pl-7 white">label</span><span class="require">: "</span><span class="green">Subtotal</span><span class="require">",</span>
                                        <br>
                                            <span class="pl-7 white">type</span><span class="require">: "</span><span class="green">SUBTOTAL</span><span class="require">",</span>
                                        <br>
                                            <span class="pl-7 white">price</span><span class="require">: "</span><span class="green">10</span><span class="require">",</span>
                                        <br>
                                            <span class="pl-6 require">} ],</span>
                                        <br>
                                            <span class="pl-6 white">countryCode</span><span class="require">: '</span><span class="green">ES</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-6 white">currencyCode</span><span class="require">: '</span><span class="green">EUR</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-6 white">totalPriceStatus</span><span class="require">: '</span><span class="green">FINAL</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-6 white">totalPrice</span><span class="require">: '</span><span class="green">10</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-6 white">totalPriceLabel</span><span class="require">: '</span><span class="green">Total</span><span class="require">',</span>
                                        <br>
                                            <span class="pl-5 require">};</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Mostrar la hoja de pago de Google Pay cuando se hace clic en el botón de pago de Google Pay</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">onGooglePaymentButtonClicked</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-5 purple">const </span><span class="white">paymentDataRequest </span><span class="new">= </span><span class="new">getGooglePaymentDataRequest</span><span class="require">();</span>
                                        <br>
                                            <span class="pl-5 white">paymentDataRequest</span><span class="require">.</span><span class="white">transactionInfo </span><span class="require">= </span><span class="new">getGoogleTransactionInfo</span><span class="require">();</span>
                                        <br>
                                        <br>
                                            <span class="pl-5 purple">const </span><span class="white">paymentsClient </span><span class="new">= </span><span class="new">getGooglePaymentsClient</span><span class="require">();</span>
                                        <br>
                                            <span class="pl-5 white">paymentsClient</span><span class="require">.</span><span class="white">loadPaymentData</span><span class="require">(</span><span class="white">paymentDataRequest</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                        <br>
                                            <span class="pl-4 comments">// Procesar los datos de pago devueltos por la API de Google Pay</span>
                                        <br>
                                            <span class="pl-4 purple">function </span><span class="new">processPayment</span><span class="require">(</span><span class="orange">paymentData</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-5 purple">return </span><span class="new">new </span><span class="yellow">Promise</span><span class="require">(</span><span class="purple">function</span><span class="require">(</span><span class="orange">resolve</span><span class="require">, </span><span class="orange">reject</span><span class="require">) {</span>
                                        <br>
                                            <span class="pl-6 new">setTimeout</span><span class="require">(</span><span class="purple">function</span><span class="require">() {</span>
                                        <br>
                                            <span class="pl-7 white">paymentToken </span><span class="require">= </span><span class="white">paymentData</span><span class="require">.</span><span class="new">paymentMethodData</span><span class="require">.</span><span class="new">tokenizationData</span><span class="require">.</span><span class="new">token</span><span class="require">;</span>
                                        <br>
                                            <span class="pl-7 new">resolve</span><span class="require">({});</span>
                                        <br>
                                            <span class="pl-6 require">}, </span><span class="orange">3000</span><span class="require">);</span>
                                        <br>
                                            <span class="pl-5 require">});</span>
                                        <br>
                                            <span class="pl-4 require">}</span>
                                        <br>
                                            <span class="pl-2 new">&lt;</span><span class="script">/script</span><span class="new">&gt;</span>
                                        <br>
                                        <br>
                                    </code>
                                </div>
							</div>            
						</div>
						<!-- /Punto 1-->

                        <!-- Punto 2-->
                        <div class="contenedor">
                            <div class="col-lg-12" >
                                <div class="pl-3 pt-3 pr-3 text-justify">
                                    <h3 class="pt-1" id="gpay2">
                                        2. Google Pay
                                    </h3>
                                    
                                    <hr>
                                    <p>
                                        El botón de pago de Google Pay siempre debe llamar a la API de Google Pay. La API muestra la hoja de pago donde los usuarios pueden seleccionar el botón y proceder con la transacción. El método JavaScript "createButton()" inserta dinámicamente las reglas CSS y un archivo SVG cargado desde el CDN de Google para un elemento HTML &lt;button>. De forma automática se muestra el botón traducido en un idioma compatible que coincide con la configuración del navegador del cliente.
                                    </p>

                                    <p>
                                        Todos los botones de pago de Google Pay que se muestran en su sitio deben cumplir con las pautas de marca de Google, que incluyen, entre otros, los siguientes requisitos:

                                        <ul>
                                            <li>El tamaño debe ser relativo a otros botones o elementos similares de la página.</li>
                                            <li>El color del botón debe contrastar con el color de fondo del área que lo rodea.</li>
                                            <li>El botón debe mantener la cantidad mínima de espacio libre en todos los lados.</li>
                                        </ul>
                                    </p>

                                    <table class="table table-borderless">
                                        <thead class="text-center">
                                            <tr>
                                                <th>Negro</th>
                                                <th>Blanco</th>
                                            </tr>
                                        </thead>
                                        <tbody class="text-center">
                                            <tr>
                                                <td>
                                                    <img class="img-fluid d-none d-sm-none d-lg-inline" style="width: 50%;" src="../../assets/img/gblack.png" alt="">
                                                    <img class="img-fluid d-lg-none d-inline" src="../../assets/img/gblack.png" alt="">
                                                </td>
                                                <td>
                                                    <img class="img-fluid d-none d-sm-none d-lg-inline" style="width: 50%;" src="../../assets/img/gwhite.png" alt="">
                                                    <img class="img-fluid d-lg-none d-inline" src="../../assets/img/gwhite.png" alt="">
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <p>
                                        <small class="form-text text-muted alert alert-success">
                                            --&gt; Aconsejamos seguir la <a target="_blank" href="https://developers.google.com/pay/api/web/guides/brand-guidelines">documentación facilitada por Google</a> para elegir el diseño más óptimo en su proyecto antes de pasar a producción.
                                        </small>
                                    </p>

                                    <h5 class="pt-4" id="paspro">2.1 Pasar a producción</h5>

                                    <hr>

                                    <p>
                                        Una vez que haya integrado la API de Google, debe obtener la aprobación de todos los lugares donde muestra o hace referencia a Google Pay en su sitio web para obtener acceso a producción. Para ello Google facilita un <a target="_blank" href="https://developers.google.com/pay/api/web/guides/test-and-deploy/integration-checklist">listado</a> donde se muestran los pasos y los requisitos para pasar a producción.
                                    </p>

                                    <p>
                                        El proceso de validación que realiza Google en su página web es el siguiente:

                                        <ul style="list-style: decimal;">
                                            <li>
                                            <!--1-->Debe enviar a Google a través del <a target="_blank" href="https://services.google.com/fb/forms/googlepayAPIenable/">siguiente enlace</a> las capturas de pantalla o videos de la integración que ha realizado en su plataforma web en entorno de pruebas (TEST) con la API de Google Pay. Cualquier modificación requerida a su integración, ya sea para funcionalidad o marca, debe hacerse en este paso.
                                            </li>

                                            <br>

                                            <li>
                                            <!--2-->Si validan su desarrollo, Google le proporcionará instrucciones para el registro y el acceso de producción a la API de Google Pay. En este paso, se facilita un <a href="https://developers.google.com/pay/api/web/reference/request-objects#MerchantInfo">merchantID</a> único para poder usar la API de Google Pay.
                                            </li>

                                            <br>

                                            <li>
                                            <!--3-->Google revisará su plataforma web en el entorno de producción.
                                            </li>

                                            <br>

                                            <li>
                                            <!--4-->Una vez aprobada la integración por parte de Google, podrá realizar operaciones con Google Pay en producción.
                                            </li>
                                        </ul>
                                    </p>

                                    <p class="pt-2 pb-2">
                                        <small class="form-text text-muted alert alert-primary">
                                            --&gt; Puede ver ejemplos de implementación en entorno de pruebas de Google Pay en su <a target="_blank" href="https://developers.google.com/pay/api/web/guides/resources/demos">documentación oficial</a>.
                                        </small>
                                    </p>
                                </div>
                            </div>            
                        </div>
                        <!-- /Punto 2-->

                        <!-- Punto 3 -->
                        <div class="contenedor">
							<div class="col-lg-12" >
                                <div class="pl-3 pt-3 pr-3 text-justify">
                                    <h3 class="pt-1" id="btnGooglePay">
                                        3. Botón de ejemplo
                                    </h3>
                                    
                                    <hr>
                                    <p>
                                        Los siguientes botones le permiten realizar una operación válida y una operación denegada.
                                    </p>
                                    <ul>
                                        <li>Para realizar una operación correcta en entorno de pruebas, el valor del importe que debe enviar es '10'.</li>
                                        <li>Para realizar una operación denegada en entorno de pruebas, el valor del importe que debe enviar es '11.01'.</li>
                                    </ul>

                                    <hr>

                                    <form id="formulario_envio" method="POST" autocomplete="off" class="col-lg-12" action="Authorization.php">
                                        <div class="row justify-content-around">
                                            <div class="col-lg-5 mt-2 mb-2 formulario text-center">
                                                <p style="padding-top:10px;">
                                                    <input type="hidden" id="importe" name="importe" value="10" />
                                                    <b>Importe:</b> <span>10€ - Operación aceptada</span>
                                                </p>
                                                <!-- Datos de tarjeta -->
                                                <div class="form-group row">
                                                    <div class="col-sm-12">
														<div id="buttonGooglePay">
															<a lang="es" class="btn btn-block" id="googlePay" title="Start Google Pay" role="link" tabindex="0"></a>
														</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>

                                    <hr>

                                    <h5 id="respuestaForm">
                                        3.2 Respuesta de la operación
                                    </h5>

                                    <div id="server-results" class="pb-3 mb-2">
                                        <p id="respuestaMsg">
                                            Su respuesta aparecerá aquí.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <!-- /Punto 3 -->
                        </div>
                    <!-- /Contenido común -->
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="../../assets/js/barraprogreso.js"></script>
    </body>
</html>